{% extends "lms/layouts/v1_base.html" %}

{% block body_attrs %} class="gray" data-init-sections="selectpickers"{% endblock body_attrs %}

{% block stylesheets %}
  <style>
    /* Dark theme support for this page */
    html[data-theme="dark"] .footer { background: #111827 !important; color: #F3F4F6 !important; border-color: #374151 !important; }
    html[data-theme="dark"] .footer a { color: #FFFFFF !important; }
    html[data-theme="dark"] .footer a:hover, html[data-theme="dark"] .footer a:focus { color: #E5E7EB !important; }
    /* Info panel should be dark and readable in dark mode */
    html[data-theme="dark"] .info-panel.csc-well { background: #111827 !important; color: #F3F4F6 !important; border-color: var(--bg) !important; }
    html[data-theme="dark"] .info-panel.csc-well a { color: #FFFFFF !important; }
    html[data-theme="dark"] .info-panel.csc-well a:hover, html[data-theme="dark"] .info-panel.csc-well a:focus { color: #E5E7EB !important; }
  </style>
{% endblock stylesheets %}
{% block content %}
  <div class="container">
    {{ crispy(filter_form) }}
    {% if not assignment_list_open and not assignment_list_archive %}
      <div class="row">
        <div class="col-xs-3"></div>
        <div class="col-xs-6 center-aligned">
          <h4>{% trans %}No assignments yet{% endtrans %}</h4>
        </div>
        <div class="col-xs-3">
        </div>
      </div>
    {% endif %}
    {% if assignment_list_open %}
      <div class="row">
        <div class="col-xs-12">
          <h3>{% trans %}Open assignments{% endtrans %}</h3>
          <table class="table" width="100%">
            <thead>
            <th width="15%">{% trans %}Deadline{% endtrans %}</th>
            <th></th>
            <th width="20%">{% trans %}Course{% endtrans %}</th>
            <th width="17%">{% trans %}State{% endtrans %}</th>
            <th width="15%">{% trans %}Assignment Format{% endtrans %}</th>
            </thead>
            {% for a_s in assignment_list_open %}
              {% set can_view = request.user.has_perm(ViewOwnStudentAssignment.name, a_s) %}
              <tr class="{{ "unread" if can_view and a_s.has_unread() else "noop" }}">
                <td>
                  {% set assignment_deadline_at_local = a_s.assignment.deadline_at_local(tz_override) %}
                  <div class="assignment-date {{ assignment_deadline_at_local|date_soon_css() }}">
                    <span class="nowrap">
                      {{ assignment_deadline_at_local|naturalday("d E Y") }}
                    </span><br>
                    {{ assignment_deadline_at_local|time("H:i") }}
                  </div>
                </td>
                <td>
                  {% if can_view %}
                    <a href="{{ a_s.get_student_url() }}">
                      {{ a_s.assignment.title }}
                    </a>
                  {% else %}
                    <span>{{ a_s.assignment.title }}</span><br/>
                    {% if not a_s.assignment.open_date_passed %}
                      {% with opens_at = a_s.assignment.opens_at_local(tz_override) %}
                        <span class="nowrap opens-at-text">Available {{ opens_at|naturalday("d E Y") }} {{ opens_at|time("H:i") }}</span>
                      {% endwith %}
                    {% endif %}
                  {% endif %}
                </td>
                <td>
                  <a href="{{ a_s.assignment.course.get_absolute_url() }}">
                    {{ a_s.assignment.course.meta_course.name }}
                  </a>
                </td>
                <td>
            <span style="white-space: nowrap;"
                  class="badge assignment-status {{ a_s.status_css_class }}">
              {{ a_s.state_display }}
            </span>
                </td>
                <td>
                  {{ a_s.assignment.get_submission_type_display() }}
                </td>
              </tr>
            {% endfor %}
          </table>
        </div>
      </div>
    {% endif %}


    {% if assignment_list_archive %}
      <div class="row">
        <div class="col-xs-12">
          <h3>{% trans %}Archive{% endtrans %}</h3>
          <table class="table" width="100%">
            <thead>
            <th width="15%">{% trans %}Deadline{% endtrans %}</th>
            <th></th>
            <th width="20%">{% trans %}Course{% endtrans %}</th>
            <th width="17%">{% trans %}State{% endtrans %}</th>
            <th width="15%">{% trans %}Assignment Format{% endtrans %}</th>
            </thead>
            {% for a_s in assignment_list_archive %}
              {% set can_view = request.user.has_perm(ViewOwnStudentAssignment.name, a_s) %}
              <tr class="{{ "unread" if can_view and a_s.has_unread() else "noop" }}">
                <td>
                  <div class="assignment-date">
                    {%  with assignment_deadline_at_local = a_s.assignment.deadline_at_local(tz_override) %}
                      <span class="nowrap">{{ assignment_deadline_at_local|naturalday("d E Y") }}</span><br>
                      {{ assignment_deadline_at_local|time("H:i") }}
                    {% endwith %}
                  </div>
                </td>
                <td>
                  {% if can_view %}
                    <a href="{{ a_s.get_student_url() }}">
                      {{ a_s.assignment.title }}
                    </a>
                  {% else %}
                    <span>{{ a_s.assignment.title }}</span><br/>
                    {% if not a_s.assignment.open_date_passed %}
                      {% with opens_at = a_s.assignment.opens_at_local(tz_override) %}
                        <span class="nowrap opens-at-text">Available {{ opens_at|naturalday("d E Y") }} {{ opens_at|time("H:i") }}</span>
                      {% endwith %}
                    {% endif %}
                  {% endif %}
                </td>
                <td>
                  <a href="{{ a_s.assignment.course.get_absolute_url() }}">
                    {{ a_s.assignment.course.meta_course.name }}
                  </a>
                </td>
                <td>
            <span style="white-space: nowrap;"
                  class="badge assignment-status {{ a_s.status_css_class }}">
              {{ a_s.state_display }}
            </span>
                </td>
                <td>
                  {{ a_s.assignment.get_submission_type_display() }}
                </td>
              </tr>
            {% endfor %}
          </table>
        </div>
      </div>
    {% endif %}
  </div>
{% endblock content %}
